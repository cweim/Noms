---
phase: 06-mobile-app-foundation
plan: 01
type: execute
---

<objective>
Set up Expo Router navigation with bottom tabs and Supabase client integration.

Purpose: Establish the mobile app's navigation structure and authentication foundation for all subsequent UI phases.
Output: Working tab navigation with Now/Saved/Journal screens and authenticated API access.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context
@.planning/phases/01-project-foundation/01-02-SUMMARY.md

# Current mobile setup
@mobile/package.json
@mobile/App.tsx
@mobile/app.json

**Tech stack available:**
- Expo ~54.0.31 with React 19.1.0
- TypeScript ~5.9.2
- ESLint + Prettier configured

**Established patterns:**
- UI_SPEC colors: background #F5F5F5, splash #FFF8E7, text #1F2937
- SafeAreaView for iOS notch handling
- fontWeight 900, letterSpacing -0.5 for titles

**Constraining decisions:**
- Phase 4: Client-side auth with Supabase JS SDK
- Mobile app connects to backend API at configurable URL
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install and configure Expo Router</name>
  <files>mobile/package.json, mobile/app.json, mobile/app/_layout.tsx, mobile/app/index.tsx</files>
  <action>
    1. Install Expo Router and dependencies:
       ```
       npx expo install expo-router expo-linking expo-constants expo-status-bar
       ```

    2. Update app.json to use Expo Router:
       - Add "scheme": "noms" for deep linking
       - Add "experiments": { "typedRoutes": true }

    3. Update package.json main entry point:
       - Change "main" from "index.ts" to "expo-router/entry"

    4. Create app/ directory structure:
       - Create mobile/app/_layout.tsx as root layout (wraps all screens)
       - Create mobile/app/index.tsx as home redirect

    5. Root layout (_layout.tsx):
       ```tsx
       import { Stack } from 'expo-router';

       export default function RootLayout() {
         return <Stack screenOptions={{ headerShown: false }} />;
       }
       ```

    6. Index redirect (index.tsx):
       ```tsx
       import { Redirect } from 'expo-router';

       export default function Index() {
         return <Redirect href="/(tabs)/now" />;
       }
       ```

    7. Delete old files no longer needed:
       - Remove mobile/App.tsx (replaced by app/_layout.tsx)
       - Remove mobile/index.ts (replaced by expo-router/entry)

    Use expo-router v4 patterns (file-based routing). Do NOT use React Navigation directly.
  </action>
  <verify>
    1. cd mobile && npm install completes without errors
    2. app/ directory exists with _layout.tsx and index.tsx
    3. package.json main is "expo-router/entry"
  </verify>
  <done>
    - Expo Router installed and configured
    - Root layout renders Stack navigator
    - Index redirects to tabs
    - Old App.tsx and index.ts removed
  </done>
</task>

<task type="auto">
  <name>Task 2: Create bottom tab navigation with three screens</name>
  <files>mobile/app/(tabs)/_layout.tsx, mobile/app/(tabs)/now.tsx, mobile/app/(tabs)/saved.tsx, mobile/app/(tabs)/journal.tsx</files>
  <action>
    1. Create mobile/app/(tabs)/ directory for tab group

    2. Create tab layout (mobile/app/(tabs)/_layout.tsx):
       ```tsx
       import { Tabs } from 'expo-router';
       import { Ionicons } from '@expo/vector-icons';

       export default function TabLayout() {
         return (
           <Tabs
             screenOptions={{
               tabBarActiveTintColor: '#1F2937',
               tabBarInactiveTintColor: '#9CA3AF',
               tabBarStyle: {
                 backgroundColor: '#FFFFFF',
                 borderTopColor: '#E5E7EB',
               },
               headerStyle: {
                 backgroundColor: '#F5F5F5',
               },
               headerTitleStyle: {
                 fontWeight: '900',
                 color: '#1F2937',
               },
             }}
           >
             <Tabs.Screen
               name="now"
               options={{
                 title: 'Now',
                 tabBarIcon: ({ color, size }) => (
                   <Ionicons name="location" size={size} color={color} />
                 ),
               }}
             />
             <Tabs.Screen
               name="saved"
               options={{
                 title: 'Saved',
                 tabBarIcon: ({ color, size }) => (
                   <Ionicons name="bookmark" size={size} color={color} />
                 ),
               }}
             />
             <Tabs.Screen
               name="journal"
               options={{
                 title: 'Journal',
                 tabBarIcon: ({ color, size }) => (
                   <Ionicons name="camera" size={size} color={color} />
                 ),
               }}
             />
           </Tabs>
         );
       }
       ```

    3. Install @expo/vector-icons if not present (usually included with Expo)

    4. Create placeholder screens with UI_SPEC styling:

       now.tsx:
       ```tsx
       import { View, Text, StyleSheet } from 'react-native';

       export default function NowScreen() {
         return (
           <View style={styles.container}>
             <Text style={styles.title}>Find Food Now</Text>
             <Text style={styles.subtitle}>Map and restaurant picker coming soon</Text>
           </View>
         );
       }

       const styles = StyleSheet.create({
         container: {
           flex: 1,
           backgroundColor: '#F5F5F5',
           alignItems: 'center',
           justifyContent: 'center',
           padding: 20,
         },
         title: {
           fontSize: 24,
           fontWeight: '900',
           color: '#1F2937',
           marginBottom: 8,
         },
         subtitle: {
           fontSize: 16,
           color: '#6B7280',
         },
       });
       ```

       saved.tsx and journal.tsx follow same pattern with appropriate titles:
       - Saved: "Your Places" / "Saved restaurants will appear here"
       - Journal: "Food Journal" / "Your food memories will appear here"

    Use Ionicons for tab icons (location, bookmark, camera). Apply UI_SPEC colors consistently.
  </action>
  <verify>
    1. cd mobile && npx expo start --ios (or --android) launches app
    2. Bottom tab bar visible with 3 tabs
    3. Tapping each tab shows corresponding screen
    4. Active/inactive tab colors work correctly
  </verify>
  <done>
    - (tabs) group with _layout.tsx
    - Three tab screens: now, saved, journal
    - Tab bar with icons and UI_SPEC styling
    - Navigation between tabs works
  </done>
</task>

<task type="auto">
  <name>Task 3: Add Supabase client and auth context</name>
  <files>mobile/package.json, mobile/lib/supabase.ts, mobile/lib/auth-context.tsx, mobile/app/_layout.tsx, mobile/.env.example</files>
  <action>
    1. Install Supabase JS client and async storage:
       ```
       npx expo install @supabase/supabase-js @react-native-async-storage/async-storage
       ```

    2. Create mobile/lib/ directory for shared utilities

    3. Create Supabase client (mobile/lib/supabase.ts):
       ```tsx
       import 'react-native-url-polyfill/dist/polyfill';
       import AsyncStorage from '@react-native-async-storage/async-storage';
       import { createClient } from '@supabase/supabase-js';

       const supabaseUrl = process.env.EXPO_PUBLIC_SUPABASE_URL || '';
       const supabaseAnonKey = process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY || '';

       export const supabase = createClient(supabaseUrl, supabaseAnonKey, {
         auth: {
           storage: AsyncStorage,
           autoRefreshToken: true,
           persistSession: true,
           detectSessionInUrl: false,
         },
       });
       ```

    4. Install URL polyfill for React Native:
       ```
       npx expo install react-native-url-polyfill
       ```

    5. Create auth context (mobile/lib/auth-context.tsx):
       ```tsx
       import { createContext, useContext, useEffect, useState, ReactNode } from 'react';
       import { Session, User } from '@supabase/supabase-js';
       import { supabase } from './supabase';

       type AuthContextType = {
         session: Session | null;
         user: User | null;
         loading: boolean;
         signOut: () => Promise<void>;
       };

       const AuthContext = createContext<AuthContextType>({
         session: null,
         user: null,
         loading: true,
         signOut: async () => {},
       });

       export function AuthProvider({ children }: { children: ReactNode }) {
         const [session, setSession] = useState<Session | null>(null);
         const [loading, setLoading] = useState(true);

         useEffect(() => {
           // Get initial session
           supabase.auth.getSession().then(({ data: { session } }) => {
             setSession(session);
             setLoading(false);
           });

           // Listen for auth changes
           const { data: { subscription } } = supabase.auth.onAuthStateChange(
             (_event, session) => {
               setSession(session);
             }
           );

           return () => subscription.unsubscribe();
         }, []);

         const signOut = async () => {
           await supabase.auth.signOut();
         };

         return (
           <AuthContext.Provider
             value={{
               session,
               user: session?.user ?? null,
               loading,
               signOut,
             }}
           >
             {children}
           </AuthContext.Provider>
         );
       }

       export const useAuth = () => useContext(AuthContext);
       ```

    6. Wrap app in AuthProvider (update mobile/app/_layout.tsx):
       ```tsx
       import { Stack } from 'expo-router';
       import { AuthProvider } from '../lib/auth-context';

       export default function RootLayout() {
         return (
           <AuthProvider>
             <Stack screenOptions={{ headerShown: false }} />
           </AuthProvider>
         );
       }
       ```

    7. Update mobile/.env.example with Supabase variables:
       ```
       EXPO_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
       EXPO_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
       EXPO_PUBLIC_API_URL=http://localhost:8000
       ```

    Use EXPO_PUBLIC_ prefix for env vars (Expo convention). Use AsyncStorage for session persistence.
  </action>
  <verify>
    1. npm install completes without errors
    2. mobile/lib/supabase.ts and auth-context.tsx exist
    3. App still launches without errors: npx expo start
    4. No TypeScript errors: cd mobile && npm run tsc
  </verify>
  <done>
    - @supabase/supabase-js installed with AsyncStorage
    - Supabase client configured with env vars
    - AuthProvider wraps app with session state
    - useAuth hook available for components
    - .env.example updated with Supabase vars
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Expo Router installed and app launches
- [ ] Bottom tabs visible with Now/Saved/Journal
- [ ] Tab navigation works (tap switches screens)
- [ ] Supabase client configured
- [ ] AuthProvider wraps app
- [ ] No TypeScript errors (npm run tsc)
- [ ] No runtime errors on app launch
</verification>

<success_criteria>

- All tasks completed
- Tab-based navigation working
- Supabase client ready for auth flows
- UI follows established styling patterns
- App launches without errors on iOS/Android
</success_criteria>

<output>
After completion, create `.planning/phases/06-mobile-app-foundation/06-01-SUMMARY.md`

Phase 6 complete with this single plan - ready for Phase 7: Map View
</output>
