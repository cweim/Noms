---
phase: 07-map-view
plan: 02
type: execute
---

<objective>
Add restaurant marker pins to the map with custom styling.

Purpose: Enable users to see restaurant locations visually on the map, preparing for the restaurant picker flow in Phase 9.
Output: Map displays restaurant pins that can be tapped to show basic info.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan in this phase
@.planning/phases/07-map-view/07-01-SUMMARY.md

# Current mobile setup
@mobile/app/(tabs)/now.tsx
@mobile/lib/use-location.ts

**Tech stack available:**
- react-native-maps (from 07-01)
- expo-location (from 07-01)
- Expo ~54.0.31 with React 19.1.0

**Established patterns:**
- UI_SPEC colors: background #F5F5F5, text #1F2937
- lib/ directory for shared utilities
- Ionicons from @expo/vector-icons

**Backend API available:**
- GET /api/places/search?lat={lat}&lng={lng}&radius={radius}
- Returns: PlaceSearchResponse with google_place_id, name, address, location, rating
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PlaceMarker component</name>
  <files>mobile/components/PlaceMarker.tsx</files>
  <action>
    Create a reusable marker component for restaurants:

    1. Create mobile/components/ directory if it doesn't exist
    2. Create PlaceMarker.tsx with:
       - Uses react-native-maps Marker component
       - Custom callout showing restaurant name and rating
       - Restaurant icon pin (use Ionicons "restaurant" or "location")

    ```tsx
    import { Marker, Callout } from 'react-native-maps';
    import { View, Text, StyleSheet } from 'react-native';
    import { Ionicons } from '@expo/vector-icons';

    interface Place {
      google_place_id: string;
      name: string;
      address?: string;
      location: {
        lat: number;
        lng: number;
      };
      rating?: number;
    }

    interface PlaceMarkerProps {
      place: Place;
      onPress?: (place: Place) => void;
    }

    export function PlaceMarker({ place, onPress }: PlaceMarkerProps) {
      return (
        <Marker
          coordinate={{
            latitude: place.location.lat,
            longitude: place.location.lng,
          }}
          onPress={() => onPress?.(place)}
        >
          {/* Custom marker view - warm orange color to match brand */}
          <View style={styles.markerContainer}>
            <Ionicons name="restaurant" size={20} color="#FFFFFF" />
          </View>

          {/* Callout shown when marker is tapped */}
          <Callout>
            <View style={styles.callout}>
              <Text style={styles.calloutTitle}>{place.name}</Text>
              {place.rating && (
                <Text style={styles.calloutRating}>â˜… {place.rating.toFixed(1)}</Text>
              )}
              {place.address && (
                <Text style={styles.calloutAddress} numberOfLines={1}>
                  {place.address}
                </Text>
              )}
            </View>
          </Callout>
        </Marker>
      );
    }
    ```

    Styling:
    - Marker: Rounded pin with warm orange background (#F97316)
    - Callout: White background, UI_SPEC text colors
    - Callout width: ~200px to fit name and rating

    Export the Place interface for use elsewhere.
  </action>
  <verify>
    1. File exists: mobile/components/PlaceMarker.tsx
    2. cd mobile && npm run tsc (no TypeScript errors)
    3. Component exports PlaceMarker and Place interface
  </verify>
  <done>
    - PlaceMarker component created
    - Custom orange pin marker style
    - Callout shows name, rating, address
    - onPress callback prop for future interactions
    - Place interface exported
  </done>
</task>

<task type="auto">
  <name>Task 2: Add markers to map from mock data</name>
  <files>mobile/app/(tabs)/now.tsx</files>
  <action>
    Update the Now screen to render PlaceMarker components on the map:

    1. Import PlaceMarker component
    2. Add mock places data for development (will be replaced with API calls in Phase 9)
    3. Render markers for each place
    4. Handle marker press (just log for now, will connect to cards in Phase 9)

    ```tsx
    import { PlaceMarker, Place } from '../../components/PlaceMarker';

    // Mock data for development - will be replaced with API calls
    const MOCK_PLACES: Place[] = [
      {
        google_place_id: 'mock_1',
        name: 'The Cozy Cafe',
        address: '123 Main St',
        location: { lat: 0, lng: 0 }, // Will be relative to user location
        rating: 4.5,
      },
      {
        google_place_id: 'mock_2',
        name: 'Pasta Paradise',
        address: '456 Oak Ave',
        location: { lat: 0, lng: 0 },
        rating: 4.2,
      },
      {
        google_place_id: 'mock_3',
        name: 'Sushi Central',
        address: '789 Pine Blvd',
        location: { lat: 0, lng: 0 },
        rating: 4.8,
      },
    ];

    // In the component, generate mock locations relative to user
    const placesWithLocation = useMemo(() => {
      if (!location) return [];
      return MOCK_PLACES.map((place, index) => ({
        ...place,
        location: {
          lat: location.latitude + (Math.random() - 0.5) * 0.01,
          lng: location.longitude + (Math.random() - 0.5) * 0.01,
        },
      }));
    }, [location]);

    // Inside MapView:
    {placesWithLocation.map((place) => (
      <PlaceMarker
        key={place.google_place_id}
        place={place}
        onPress={(p) => console.log('Tapped:', p.name)}
      />
    ))}
    ```

    The mock data generates random positions near the user's location for visual testing.
    This will be replaced with real API calls in Phase 9 (Restaurant Picker Logic).

    Add useMemo import from react.
  </action>
  <verify>
    1. cd mobile && npm run tsc (no TypeScript errors)
    2. now.tsx imports and renders PlaceMarker components
    3. Mock places array defined
    4. Markers rendered inside MapView
  </verify>
  <done>
    - PlaceMarker components rendered on map
    - Mock places data for development testing
    - Markers appear near user's location
    - Tapping marker shows callout with name/rating
    - Console logs marker press for debugging
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PlaceMarker component exists with custom styling
- [ ] Now screen renders multiple markers on the map
- [ ] Markers show callout when tapped
- [ ] No TypeScript errors: cd mobile && npm run tsc
- [ ] Phase 7 complete - map view with location and markers working
</verification>

<success_criteria>

- All tasks completed
- Restaurant markers visible on map
- Callout displays place info on tap
- Markers positioned near user location
- Phase 7 complete
</success_criteria>

<output>
After completion, create `.planning/phases/07-map-view/07-02-SUMMARY.md`

Phase 7 complete with this plan - ready for Phase 8: Restaurant Cards
</output>
