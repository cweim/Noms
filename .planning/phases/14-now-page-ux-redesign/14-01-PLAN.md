---
phase: 14-now-page-ux-redesign
plan: 01
type: execute
---

<objective>
Create bottom card layout with map highlighting for Now screen

Purpose: Transform the picker from center-screen card to bottom-positioned compact card with map centered on current restaurant for spatial context.
Output: Redesigned Now screen with bottom card and animated map centering
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-restaurant-cards/08-01-SUMMARY.md
@.planning/phases/09-restaurant-picker-logic/09-02-SUMMARY.md

**Key files to modify:**
@mobile/app/(tabs)/now.tsx
@mobile/components/RestaurantCard.tsx
@mobile/components/RestaurantPicker.tsx
@mobile/components/SwipeableCard.tsx

**Current state:**
- RestaurantCard: Large vertical card (SCREEN_WIDTH - 40 wide, 1.33 aspect ratio)
- SwipeableCard: Swipe left/right with center positioning
- RestaurantPicker: Shows one card centered over map
- Now screen: Map full screen, picker overlay centered

**Target state:**
- BottomRestaurantCard: Compact horizontal card at screen bottom (~120px height)
- Map animates to center on current restaurant's location
- Swipe right still saves, swipe left skips (Phase 15 adds swipe up)
- More map visible, less card obtrusion

**Design requirements (from PROJECT.md):**
- Calm, low-density interface
- One-handed usable
- Playful and tactile (warm colors, soft shadows, rounded shapes)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BottomRestaurantCard component</name>
  <files>mobile/components/BottomRestaurantCard.tsx</files>
  <action>
  Create a new compact horizontal card component for bottom positioning:

  ```
  Layout: [Photo 100x100] [Info: Name, Rating, Address] [Skip/Save buttons]
  Height: ~120px
  Width: Full screen minus padding (16px each side)
  Position: Will be positioned by parent, not self-positioned
  ```

  Props interface:
  - place: Place
  - photoUrl?: string
  - onSkip: (place: Place) => void
  - onSave: (place: Place) => void

  Features:
  - Square photo thumbnail (100x100) on left with rounded corners
  - Info section in middle: name (1 line), rating with star, address (1 line)
  - Two action buttons on right: Skip (X icon, red) and Save (heart icon, green)
  - Use Ionicons for icons (already available)
  - White background, rounded corners (16px), shadow for depth
  - TouchableOpacity for button presses (not swipe gestures for now)

  Note: NOT a swipeable card - buttons handle actions. Swipe gestures come in Phase 15.
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>BottomRestaurantCard component created with compact horizontal layout and action buttons</done>
</task>

<task type="auto">
  <name>Task 2: Update Now screen with bottom card and map centering</name>
  <files>mobile/app/(tabs)/now.tsx</files>
  <action>
  Redesign Now screen layout:

  1. Replace RestaurantPicker with direct BottomRestaurantCard usage
  2. Position card at bottom of screen (above tab bar, ~100px from bottom)
  3. Add MapView ref to control map programmatically
  4. When currentPlace changes, animate map to center on that restaurant:
     - Use mapRef.current.animateToRegion() with place.location
     - Duration ~500ms for smooth transition
     - Keep appropriate zoom level (delta: 0.005)

  5. Highlight current restaurant marker:
     - Add selectedPlaceId state
     - Pass to PlaceMarker to show different style when selected
     - Use larger/different color marker for current restaurant

  6. Keep state management:
     - skippedIds Set for tracking dismissed places
     - currentPlace from filtered array
     - handleSkip and handleSave callbacks

  Layout structure:
  ```
  <View flex:1>
    <MapView flex:1 ref={mapRef} />
    <View position:absolute bottom:100 left:16 right:16>
      {currentPlace && <BottomRestaurantCard ... />}
      {!currentPlace && <EmptyState />}
    </View>
  </View>
  ```

  Import getAuthToken and getPhotoUrl from lib/api for photo URLs.
  </action>
  <verify>App renders with card at bottom and map centers on current restaurant</verify>
  <done>Now screen shows bottom card, map animates to current restaurant location</done>
</task>

<task type="auto">
  <name>Task 3: Update PlaceMarker for selected state</name>
  <files>mobile/components/PlaceMarker.tsx</files>
  <action>
  Add visual distinction for the currently selected place:

  1. Add optional prop: isSelected?: boolean
  2. When isSelected is true:
     - Use larger marker size (48 vs 32)
     - Use accent color (brighter orange #F97316 or use a pulse/glow effect)
     - Optionally show callout automatically

  3. Update marker styling to be clearly different:
     - Selected: larger, more prominent
     - Normal: standard orange marker

  Keep backward compatible - isSelected defaults to false.
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>PlaceMarker shows visual distinction for selected restaurant</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] TypeScript check passes: `cd mobile && npx tsc --noEmit`
- [ ] BottomRestaurantCard component exists and renders correctly
- [ ] Now screen shows card at bottom (not center)
- [ ] Map animates to current restaurant when card changes
- [ ] Selected marker is visually distinct
- [ ] Skip button advances to next restaurant
- [ ] Save button saves and advances to next restaurant
</verification>

<success_criteria>
- Bottom card layout implemented
- Map centers on current restaurant
- Selected marker highlighted
- All existing functionality preserved (skip, save)
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/14-now-page-ux-redesign/14-01-SUMMARY.md`
</output>
