---
phase: 13-bug-fix-backend-prep
plan: 02
type: execute
---

<objective>
Extend backend to support place details for Phase 16

Purpose: Prepare the backend to return full place details including hours, reviews, rating, and multiple photos for the upcoming Place Details Screen.
Output: Enhanced place details endpoint with full Google Places data
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-google-places-integration/05-03-SUMMARY.md

**Key files:**
@backend/app/services/places.py
@backend/app/routers/places.py
@backend/app/schemas/places.py

**Phase 16 requirements (Place Details Screen):**
- Name, address, phone, opening hours
- Photo gallery (multiple photos)
- Google ratings and reviews
- Accessible from picker cards and saved places

**Current state:**
- `get_place_details()` fetches: place_id, name, formatted_address, geometry, photos, types, rating, price_level, opening_hours, website, formatted_phone_number
- But router may not expose all fields
- Need to ensure full details are available via API
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PlaceDetails response schema</name>
  <files>backend/app/schemas/places.py</files>
  <action>
  Add a comprehensive PlaceDetails Pydantic model with all fields needed for Phase 16:

  ```python
  class OpeningHours(BaseModel):
      open_now: Optional[bool] = None
      weekday_text: Optional[list[str]] = None

  class PlacePhoto(BaseModel):
      photo_reference: str
      height: Optional[int] = None
      width: Optional[int] = None

  class PlaceDetails(BaseModel):
      place_id: str
      name: str
      address: Optional[str] = None
      phone: Optional[str] = None
      website: Optional[str] = None
      rating: Optional[float] = None
      price_level: Optional[int] = None
      opening_hours: Optional[OpeningHours] = None
      photos: list[PlacePhoto] = []
      types: list[str] = []
      lat: Optional[float] = None
      lng: Optional[float] = None
  ```

  Export from __init__.py
  </action>
  <verify>python -c "from app.schemas.places import PlaceDetails; print('OK')"</verify>
  <done>PlaceDetails schema with all required fields exported</done>
</task>

<task type="auto">
  <name>Task 2: Add GET /api/places/{place_id}/details endpoint</name>
  <files>backend/app/routers/places.py</files>
  <action>
  Add a new endpoint to fetch full place details:

  ```python
  @router.get("/{place_id}/details", response_model=PlaceDetails)
  async def get_place_details_endpoint(place_id: str):
      """
      Get full details for a place.
      Returns comprehensive info including hours, reviews, photos.
      """
      service = get_places_service()
      details = service.get_place_details(place_id)

      if not details:
          raise NotFoundError(message="Place not found", detail={"place_id": place_id})

      # Map Google API response to schema
      opening_hours = None
      if details.get("opening_hours"):
          opening_hours = OpeningHours(
              open_now=details["opening_hours"].get("open_now"),
              weekday_text=details["opening_hours"].get("weekday_text")
          )

      photos = []
      for photo in details.get("photos", [])[:5]:  # Limit to 5 photos
          photos.append(PlacePhoto(
              photo_reference=photo.get("photo_reference"),
              height=photo.get("height"),
              width=photo.get("width")
          ))

      geometry = details.get("geometry", {}).get("location", {})

      return PlaceDetails(
          place_id=details.get("place_id"),
          name=details.get("name"),
          address=details.get("formatted_address"),
          phone=details.get("formatted_phone_number"),
          website=details.get("website"),
          rating=details.get("rating"),
          price_level=details.get("price_level"),
          opening_hours=opening_hours,
          photos=photos,
          types=details.get("types", []),
          lat=geometry.get("lat"),
          lng=geometry.get("lng")
      )
  ```

  Import NotFoundError from app.errors and schemas from app.schemas.places
  </action>
  <verify>curl http://localhost:8000/api/places/ChIJN1t_tDeuEmsRUsoyG83frY4/details (use a known place_id)</verify>
  <done>Details endpoint returns full place info with all fields</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PlaceDetails schema created with all required fields
- [ ] GET /api/places/{place_id}/details endpoint works
- [ ] Response includes: name, address, phone, hours, photos, rating
- [ ] No Python import errors
</verification>

<success_criteria>
- New endpoint returns comprehensive place details
- Schema matches Phase 16 requirements
- Backend ready for Place Details Screen implementation
</success_criteria>

<output>
After completion, create `.planning/phases/13-bug-fix-backend-prep/13-02-SUMMARY.md`
</output>
